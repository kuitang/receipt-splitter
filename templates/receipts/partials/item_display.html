{% comment %}
Template partial for displaying a line item.
Context variables:
- item: The LineItem object
- show_calculations: Boolean to show tax/tip calculations (default: False)
- editable: Boolean for edit mode (default: False)
- show_claims: Boolean to show claim interface (default: False)
- available_quantity: Number of unclaimed items (for claim mode)
{% endcomment %}

{% if editable %}
<div class="item-row flex gap-2 items-start" data-item-id="{{ item.id }}">
    <div class="flex-1 border rounded-lg p-4">
        <div class="flex gap-2 items-center">
            <div class="flex-1">
                <input type="text" 
                       value="{{ item.name }}"
                       placeholder="Item name"
                       class="item-name w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="w-16">
                <input type="number" 
                       value="{{ item.quantity }}"
                       min="1"
                       placeholder="Qty"
                       class="item-quantity w-full px-2 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 text-center tabular-nums">
            </div>
            <span class="text-gray-500 font-medium">×</span>
            <div class="w-24">
                <input type="number" 
                       value="{{ item.unit_price|floatformat:2 }}"
                       step="0.01"
                       placeholder="Price"
                       class="item-price w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 text-right tabular-nums">
            </div>
            <span class="text-gray-500 font-medium">=</span>
            <div class="w-28">
                <input type="number" 
                       value="{{ item.total_price|floatformat:2 }}"
                       step="0.01"
                       placeholder="Total"
                       class="item-total w-full px-3 py-2 border border-gray-300 rounded-lg text-sm font-semibold focus:ring-2 focus:ring-blue-500 text-right tabular-nums bg-gray-50"
                       readonly>
            </div>
        </div>
        <div class="mt-2">
            <p class="text-gray-500 text-xs item-proration"></p>
        </div>
    </div>
    <button data-action="remove-item" class="text-red-600 hover:text-red-800 p-2 hover:bg-red-50 rounded-lg transition-colors mt-3">
        <div class="w-5 h-5 flex items-center justify-center text-lg font-bold">×</div>
    </button>
</div>
{% else %}
<div class="flex justify-between items-start">
    <div class="flex-1">
        <h3 class="font-semibold text-lg">{{ item.name }}</h3>
        <p class="text-gray-600 text-sm">
            {% if item.quantity > 1 %}
            ${{ item.unit_price|floatformat:2 }} × {{ item.quantity }} = ${{ item.total_price|floatformat:2 }}
            {% else %}
            ${{ item.total_price|floatformat:2 }}
            {% endif %}
        </p>
        {% if show_calculations %}
        <p class="text-gray-500 text-xs mt-1">
            + Tax: ${{ item.prorated_tax|floatformat:2 }} 
            + Tip: ${{ item.prorated_tip|floatformat:2 }}
            = <span class="font-semibold item-share-amount" data-amount="{{ item.get_per_item_share|floatformat:2 }}">${{ item.get_per_item_share|floatformat:2 }}</span> per item
        </p>
        {% endif %}
    </div>
    
    {% if show_claims and viewer_name and receipt.is_finalized %}
    <div class="ml-4">
        <div class="flex items-center space-x-2">
            <label class="text-sm text-gray-600">{% if is_user_finalized %}Claimed:{% else %}Claim:{% endif %}</label>
            <input type="number" 
                   class="claim-quantity w-20 px-2 py-1 border rounded {% if is_user_finalized or available_quantity == 0 and my_existing_claim == 0 %}border-gray-200 bg-gray-50 text-gray-600{% else %}border-gray-300{% endif %}"
                   min="0"
                   max="{{ my_existing_claim|add:available_quantity }}"
                   value="{{ my_existing_claim|default:0 }}"
                   data-item-id="{{ item.id }}"
                   {% if is_user_finalized or available_quantity == 0 and my_existing_claim == 0 %}readonly disabled{% endif %}>
        </div>
    </div>
    {% endif %}
</div>

{% if claims %}
<div class="mt-3 pt-3 border-t">
    <p class="text-sm text-gray-600 mb-1">Claimed by:</p>
    <div class="flex flex-wrap gap-2">
        {% for claim in claims %}
        <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">
            {{ claim.claimer_name }} ({{ claim.quantity_claimed }})
        </span>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endif %}